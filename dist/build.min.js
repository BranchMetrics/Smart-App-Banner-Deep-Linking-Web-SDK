(function() {function k(b){var a=typeof b;if("object"==a)if(b){if(b instanceof Array)return"array";if(b instanceof Object)return a;var d=Object.prototype.toString.call(b);if("[object Window]"==d)return"object";if("[object Array]"==d||"number"==typeof b.length&&"undefined"!=typeof b.splice&&"undefined"!=typeof b.propertyIsEnumerable&&!b.propertyIsEnumerable("splice"))return"array";if("[object Function]"==d||"undefined"!=typeof b.call&&"undefined"!=typeof b.propertyIsEnumerable&&!b.propertyIsEnumerable("call"))return"function"}else return"null";
else if("function"==a&&"undefined"==typeof b.call)return"object";return a};var l={B:"https://bnc.lt",A:"https://api.branch.io",version:"1.6.7"};function m(){function b(){if(a.length)a[0](function(){a.shift();b()})}var a=[];return function(d){a.push(d);1==a.length&&b()}};function n(b){b=String(b);if(/^\s*$/.test(b)?0:/^[\],:{}\s\u2028\u2029]*$/.test(b.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r\u2028\u2029\x00-\x08\x0a-\x1f]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:[\s\u2028\u2029]*\[)+/g,"")))try{return eval("("+b+")")}catch(a){}throw Error("Invalid JSON string: "+b);}function r(b){var a=[];t(new v,b,a);return a.join("")}function v(){}
function t(b,a,d){if(null==a)d.push("null");else{if("object"==typeof a){if("array"==k(a)){var f=a;a=f.length;d.push("[");for(var e="",g=0;g<a;g++)d.push(e),t(b,f[g],d),e=",";d.push("]");return}if(a instanceof String||a instanceof Number||a instanceof Boolean)a=a.valueOf();else{d.push("{");e="";for(f in a)Object.prototype.hasOwnProperty.call(a,f)&&(g=a[f],"function"!=typeof g&&(d.push(e),w(f,d),d.push(":"),t(b,g,d),e=","));d.push("}");return}}switch(typeof a){case "string":w(a,d);break;case "number":d.push(isFinite(a)&&
!isNaN(a)?a:"null");break;case "boolean":d.push(a);break;case "function":d.push("null");break;default:throw Error("Unknown type: "+typeof a);}}}var x={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\x0B":"\\u000b"},z=/\uffff/.test("\uffff")?/[\\\"\x00-\x1f\x7f-\uffff]/g:/[\\\"\x00-\x1f\x7f-\xff]/g;function w(b,a){a.push('"',b.replace(z,function(a){var b=x[a];b||(b="\\u"+(a.charCodeAt(0)|65536).toString(16).substr(1),x[a]=b);return b}),'"')};function A(b,a){return b.replace(/\$(\d)/g,function(b,f){return a[parseInt(f,10)-1]})}function B(b){b.source="web-sdk";b.data&&void 0!==b.data.u&&(b.data.u=b.data.u.replace(/#r:[a-z0-9-_]+$/i,"").replace(/([\?\&]_branch_match_id=\d+)/,""));try{JSON.parse(b.data)}catch(a){b.data=r(b.data||{})}return b}
function C(b){var a="",d,f,e,g,h,p,q=0;b=b.replace(/\r\n/g,"\n");f="";for(e=0;e<b.length;e++)g=b.charCodeAt(e),128>g?f+=String.fromCharCode(g):(127<g&&2048>g?f+=String.fromCharCode(g>>6|192):(f+=String.fromCharCode(g>>12|224),f+=String.fromCharCode(g>>6&63|128)),f+=String.fromCharCode(g&63|128));for(b=f;q<b.length;)d=b.charCodeAt(q++),f=b.charCodeAt(q++),e=b.charCodeAt(q++),g=d>>2,d=(d&3)<<4|f>>4,h=(f&15)<<2|e>>6,p=e&63,isNaN(f)?h=p=64:isNaN(e)&&(p=64),a=a+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(g)+
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(d)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(p);return a};function D(b){for(var a=0;a<b.length;a++){var d=this[b[a]],d="function"==typeof d?d():d;if(d.isEnabled())return d.f={},d}}function E(b){return"branch_session"==b||"branch_session_first"==b?b:"BRANCH_WEBSDK_KEY"+b}function F(b){return"true"==b?!0:"false"==b?!1:b}
function G(b){var a=b?localStorage:sessionStorage;return{getAll:function(){var b=null,f;for(f in a)0===f.indexOf("BRANCH_WEBSDK_KEY")&&(null===b&&(b={}),b[f.replace("BRANCH_WEBSDK_KEY","")]=F(a.getItem(f)));return b},get:function(b,f){return F(f?localStorage.getItem(E(b)):a.getItem(E(b)))},set:function(b,f,e){e?localStorage.setItem(E(b),f):a.setItem(E(b),f)},remove:function(b){a.removeItem(E(b))},clear:function(){Object.keys(a).forEach(function(b){0===b.indexOf("BRANCH_WEBSDK_KEY")&&a.removeItem(b)})},
isEnabled:function(){try{return a.setItem("test",""),a.removeItem("test"),!0}catch(b){return!1}}}}D.prototype.local=function(){return G(!0)};D.prototype.session=function(){return G(!1)};
function H(b){return{getAll:function(){for(var a=document.cookie.split(";"),b={},f=0;f<a.length;f++){var e=a[f].replace(" ",""),e=e.substring(0,e.length);-1!=e.indexOf("BRANCH_WEBSDK_KEY")&&(e=e.split("="),b[e[0].replace("BRANCH_WEBSDK_KEY","")]=F(e[1]))}return b},get:function(a){a=E(a)+"=";for(var b=document.cookie.split(";"),f=0;f<b.length;f++){var e=b[f],e=e.substring(1,e.length);if(0===e.indexOf(a))return F(e.substring(a.length,e.length))}return null},set:function(a,d){var f=E(a),e="";b&&(e=new Date,
console.log(e),e.setTime(e.getTime()+31536E6),e="; branch_expiration_date="+e.toGMTString()+"; expires="+e.toGMTString());document.cookie=f+"="+d+e+"; path=/"},remove:function(a){document.cookie=E(a)+"=; expires=; path=/"},clear:function(){function a(a){document.cookie=a.substring(0,a.indexOf("="))+"=;expires=-1;path=/"}for(var d=document.cookie.split(";"),f=0;f<d.length;f++){var e=d[f],e=e.substring(1,e.length);-1!=e.indexOf("BRANCH_WEBSDK_KEY")&&(b||-1!=e.indexOf("branch_expiration_date=")?b&&0<
e.indexOf("branch_expiration_date=")&&a(e):a(e))}},isEnabled:function(){return navigator.cookieEnabled}}}D.prototype.cookie=function(){return H(!1)};D.prototype.permcookie=function(){return H(!0)};D.prototype.pojo={getAll:function(){return this.f},get:function(b){return"undefined"!=typeof this.f[b]?this.f[b]:null},set:function(b,a){this.f[b]=a},remove:function(b){delete this.f[b]},clear:function(){this.f={}},isEnabled:function(){return!0}};
D.prototype.titanium={getAll:function(){for(var b={},a=Ti.App.Properties.C(),d=0;d<a.length;d++)-1!=a[d].indexOf("BRANCH_WEBSDK_KEY")&&(b[a[d]]=F(Ti.App.Properties.getString(a[d])));return b},get:function(b){Ti.App.Properties.getString(E(b))},set:function(b,a){Ti.App.Properties.setString(E(b),a)},remove:function(b){Ti.App.Properties.setString(E(b),"")},clear:function(){for(var b=Ti.App.Properties.C(),a=0;a<b.length;a++)-1!=b[a].indexOf("BRANCH_WEBSDK_KEY")&&Ti.App.Properties.setString(b[a],"")},isEnabled:function(){try{return Ti.App.Properties.setString("test",
""),Ti.App.Properties.getString("test"),!0}catch(b){return!1}}};function I(){}I.prototype.c=0;function J(b,a,d){var f=[];if(a instanceof Array)for(b=0;b<a.length;b++)f.push(encodeURIComponent(d)+"="+encodeURIComponent(a[b]));else for(var e in a)a.hasOwnProperty(e)&&(a[e]instanceof Array||"object"==typeof a[e]?f.push(J(b,a[e],d?d+"."+e:e)):f.push(encodeURIComponent(d?d+"."+e:e)+"="+encodeURIComponent(a[e])));return f.join("&")}
function K(b,a,d){function f(b,d){"undefined"==typeof d&&(d={});if(b.h&&q.test(b.h))return d.h=b.h,d;if(b.g&&p.test(b.g))return d.g=b.g,d;throw Error(A("API request $1 missing parameter $2",[a.endpoint,"branch_key or app_id"]));}var e,g,h=a.destination+a.endpoint,p=/^[0-9]{15,20}$/,q=/key_(live|test)_[A-Za-z0-9]{32}/;if("/v1/has-app"==a.endpoint)try{a.a=f(d,a.a)}catch(y){return{error:y.message}}if(a.a)for(e in a.a)if(a.a.hasOwnProperty(e)){if(g="function"==typeof a.a[e]?a.a[e](a.endpoint,e,d[e]):
g)return{error:g};h+="/"+d[e]}var u={};for(e in a.b)if(a.b.hasOwnProperty(e)){if(g=a.b[e](a.endpoint,e,d[e]))return{error:g};g=d[e];"undefined"!=typeof g&&""!==g&&null!==g&&(u[e]=g)}if("POST"===a.method||"/v1/credithistory"===a.endpoint)try{d=f(d,u)}catch(W){return{error:W.message}}return{data:J(b,u,""),url:h}}function L(b){var a=document.createElement("script");a.type="text/javascript";a.async=!0;a.src=b;document.getElementsByTagName("head")[0].appendChild(a)}
function M(b,a,d,f,e){var g="branch_callback__"+b.c++;b=0<=a.indexOf("api.branch.io")?"&data=":"&post_data=";d="POST"==f?encodeURIComponent(C(r(d))):"";var h=window.setTimeout(function(){window[g]=function(){};e(Error("Request timed out"),null,504)},5E3);window[g]=function(a){window.clearTimeout(h);e(null,a)};L(a+(0>a.indexOf("?")?"?":"")+(d?b+d:"")+(0<=a.indexOf("/c/")?"&click=1":"")+"&callback="+g)}
function N(b,a,d,f,e,g){var h=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");h.ontimeout=function(){g(Error("Request timed out"),null,504)};h.onreadystatechange=function(){if(4===h.readyState)if(200===h.status)try{g(null,n(h.responseText),h.status)}catch(a){g(null,{},h.status)}else 402===h.status?g(Error("Not enough credits to redeem."),null,h.status):"4"!==h.status.toString().substring(0,1)&&"5"!==h.status.toString().substring(0,1)||g(Error("Error in API: "+h.status),
null,h.status)};try{h.open(f,a,!0),h.timeout=5E3,h.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),h.send(d)}catch(p){e.set("use_jsonp",!0),M(b,a,d,f,g)}}
function O(b,a,d,f,e){var g=K(b,a,d);if(g.error)e(Error(g.error));else{var h,p="";"GET"==a.method?h=g.url+"?"+g.data:(h=g.url,p=g.data);var q=2,y=function(a,b,d){a&&0<q&&"5"===d.toString().substring(0,1)?(q--,window.setTimeout(function(){u()},200)):e(a,b)},u=function(){f.get("use_jsonp")||a.I?M(b,h,d,a.method,y):N(b,h,p,a.method,f,y)};u()}};function P(b,a){return function(d,f,e){if("number"==typeof e||e)if(0==a){if("object"!=typeof e)return A("API request $1, parameter $2 is not $3",[d,f,"an object"])}else if(3==a){if(!(e instanceof Array))return A("API request $1, parameter $2 is not $3",[d,f,"an array"])}else if(2==a){if("number"!=typeof e)return A("API request $1, parameter $2 is not $3",[d,f,"a number"])}else if(4==a){if("boolean"!=typeof e)return A("API request $1, parameter $2 is not $3",[d,f,"a boolean"])}else{if("string"!=typeof e)return A("API request $1, parameter $2 is not $3",
[d,f,"a string"]);if(1!=a&&!a.test(e))return A("API request $1, parameter $2 is not $3",[d,f,"in the proper format"])}else if(b)return A("API request $1 missing parameter $2",[d,f]);return!1}}var Q=/^[0-9]{15,20}$/;function R(b){var a={},a={session_id:P(!0,Q),identity_id:P(!0,Q),sdk:P(!0,1)},d;for(d in a)a.hasOwnProperty(d)&&(b[d]=a[d]);return b}R({prefix:P(!1,1),amount:P(!0,2),expiration:P(!1,1),calculation_type:P(!0,2),location:P(!0,2),creation_type:P(!0,2),type:P(!0,1),bucket:P(!1,1)});R({});R({});
R({session_id:P(!0,Q)});R({identity_id:P(!0,Q),identity:P(!0,1)});R({});R({link_click_id:P(!1,Q),length:P(!1,2),direction:P(!1,2),begin_after_id:P(!1,Q),bucket:P(!1,1)});R({});R({identity_id:P(!0,Q),amount:P(!0,2),bucket:P(!0,1)});var aa={destination:l.A,endpoint:"/v1/url",method:"POST",J:"obj",b:R({identity_id:P(!0,Q),data:P(!1,1),tags:P(!1,3),feature:P(!1,1),campaign:P(!1,1),channel:P(!1,1),stage:P(!1,1),type:P(!1,2),alias:P(!1,1)})};R({event:P(!0,1),metadata:P(!0,0)});var S;
function T(b){return function(){var a=this,d,f,e=arguments[arguments.length-1];"function"!=typeof e?(f=function(a){if(a)throw a;},d=Array.prototype.slice.call(arguments)):(d=Array.prototype.slice.call(arguments,0,arguments.length-1)||[],f=e);a.w(function(e){function h(a,b){f(a,b);e()}if(1==a.s)return h(Error(A("Branch SDK initialization pending and a Branch method was called outside of the queue order")),null);if(2==a.s)return h(Error(A("Branch SDK initialization failed, so further methods cannot be called")),null);
if(0==a.s||!a.s)return h(Error(A("Branch SDK not initialized")),null);d.unshift(h);b.apply(a,d)})}}function U(){if(!(this instanceof U))return S||(S=new U),S;this.w=m();var b=[],b=navigator.userAgent.match(/android|i(os|p(hone|od|ad))/i)&&(navigator.userAgent.match(/android/i)||(navigator.userAgent.match(/ipad/i),1))?["local","permcookie"]:["session","cookie"];b.push("pojo");this.j=new D(b);this.c=new I;this.i="web"+l.version;this.s=0}
function ba(b,a,d,f){b.g&&(d.g=b.g);b.h&&(d.h=b.h);(a.b&&a.b.o||a.a&&a.a.o)&&b.o&&(d.o=b.o);(a.b&&a.b.l||a.a&&a.a.l)&&b.l&&(d.l=b.l);(a.b&&a.b.m||a.a&&a.a.m)&&b.m&&(d.m=b.m);(a.b&&a.b.i||a.a&&a.a.i)&&b.i&&(d.i=b.i);O(b.c,a,d,b.j,function(a,b){f(a,b)})}
U.prototype.data=T(function(b){var a;try{a=n(this.j.get("branch_session",void 0))||null}catch(d){a=null}a={data:"data"in a?a.data:null,data_parsed:"data_parsed"in a?a.F:null,has_app:"has_app"in a?a.G:null,identity:"identity"in a?a.H:null,referring_identity:"referring_identity"in a?a.K:null,referring_link:"referring_link"in a?a.D:null};var f=this.j.get("referring_link"),e=this.j.get("click_id");a.D=f?f:e?l.B+"/c/"+e:null;b(null,a)});
U.prototype.link=T(function(b,a){ba(this,aa,B(a),function(a,f){b(a,f&&f.url)})});var V=new U;if(window.c&&window.c.v)for(var X=window.c.v,Y=0;Y<X.length;Y++){var Z=X[Y];V[Z[0]].apply(V,Z[1])}"function"===typeof define&&define.amd?define("branch",function(){return V}):"object"===typeof exports&&(module.exports=V);window&&(window.c=V);})();
